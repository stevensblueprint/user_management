<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Signup</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
    />
  </head>
  <body>
    <div class="rectangle"></div>
    <div class="logo">
      <img src="/logos/logo_banner_negative.png" />
    </div>
    <div class="welcome">
      <p>Excited to have you! Let's quickly set up your account.</p>
    </div>
    <form id="form" class="input">
      <h1>Welcome {{.Displayname}}!</h1>
      <input type="text" id="first_name" placeholder="First Name" />
      <input type="text" id="last_name" placeholder="Last Name" />
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <input type="email" id="email" placeholder="Email" />
      <button type="submit">Sign Up</button>
    </form>
  </body>
  <script type="application/javascript">
    const form = document.getElementById("form");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const firstName = document.getElementById("first_name").value;
      const lastName = document.getElementById("last_name").value;
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      const email = document.getElementById("email").value;

      const url = new URL(window.location.href);
      const token = url.searchParams.get("token");

      const response = await fetch("/api/v1/users/user", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          Username: username,
          Password: password,
          Displayname: firstName + " " + lastName,
          Email: email,
          Groups: ["dev"],
        }),
      });

      if (response.status === 200) {
        window.location.replace("http://admin.sitblueprint.com/");
      } else {
        console.log(response.statusText);
      }
    });
  </script>
</html>
